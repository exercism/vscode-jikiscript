{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "JikiScript",
  "scopeName": "source.jikiscript",
  "patterns": [
    {
      "include": "#scopes.top"
    }
  ],
  "repository": {
    "literals": {
      "patterns": [
        {
          "include": "#literals.strings"
        },
        {
          "include": "#literals.booleans"
        },
        {
          "include": "#literals.numbers"
        }
      ]
    },
    "literals.strings": {
      "comment": "literals: strings",
      "name": "string.quoted.double.jikiscript",
      "begin": "\"",
      "beginCaptures": {
        "0": {
          "name": "punctuation.definition.string.begin.jikiscript"
        }
      },
      "end": "\"",
      "endCaptures": {
        "0": {
          "name": "punctuation.definition.string.end.jikiscript"
        }
      },
      "patterns": [
        {
          "name": "constant.character.escape.jikiscript",
          "match": "\\\\."
        }
      ]
    },
    "literals.booleans": {
      "comment": "literals: booleans",
      "match": "\\b(true|false)\\b(?![?!])",
      "name": "constant.language.boolean.jikiscript"
    },
    "literals.numbers": {
      "comment": "literals: numbers",
      "match": "(?x)\n\\b\n(\n  [\\d](?>_?\\d)*                             # 100_000\n  (\\.(?![^[:space:][:digit:]])(?>_?\\d)*)?   # fractional part\n  ([eE][-+]?\\d(?>_?\\d)*)?                   # 1.23e-4\n  |\n  0\n  (?:\n    [xX]\\h(?>_?\\h)*|\n    [oO]?[0-7](?>_?[0-7])*|\n    [bB][01](?>_?[01])*|\n    [dD]\\d(?>_?\\d)*\n  )                                           # A base indicator can only be used with an integer\n)\\b",
      "name": "constant.numeric.jikiscript"
    },
    "comments": {
      "begin": "(^[ \\t]+)?(?=//)",
      "beginCaptures": {
        "1": {
          "name": "punctuation.whitespace.comment.leading.jikiscript"
        }
      },
      "end": "(?!\\G)",
      "patterns": [
        {
          "begin": "//",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.comment.jikiscript"
            }
          },
          "end": "\\n",
          "name": "comment.line.double-slash.jikiscript"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "include": "#operators.comparison"
        },
        {
          "include": "#operators.logical"
        },
        {
          "include": "#operators.arithmetic"
        }
      ]
    },
    "operators.comparison": {
      "patterns": [
        {
          "match": "<(?!<|=)|>(?!<|=|>)|<=|>=|==|!=",
          "name": "keyword.operator.comparison.jikiscript"
        },
        {
          "comment": "wordy aliases",
          "match": "\\b(is)\\b",
          "name": "keyword.operator.comparison.jikiscript"
        }
      ]
    },
    "operators.logical": {
      "patterns": [
        {
          "match": "\\b(and|not|or)\\b",
          "name": "keyword.operator.logical.jikiscript"
        },
        {
          "comment": "unary not (!)",
          "match": "(?<=^|[ \\t!])!",
          "name": "keyword.operator.logical.jikiscript"
        }
      ]
    },
    "operators.arithmetic": {
      "match": "(%|\\*|\\+|-|/)",
      "name": "keyword.operator.arithmetic.jikiscript"
    },
    "punctuation": {
      "comment": "Can be used to capture valid punctuation that does not have the context yet (is not a valid line yet)",
      "patterns": [
        {
          "include": "#operators"
        },
        {
          "match": "(?<=\"):",
          "name": "punctuation.separator.key-value"
        },
        {
          "match": ",",
          "name": "punctuation.separator.comma.jikiscript"
        },
        {
          "match": "\\[",
          "name": "punctuation.section.accessor.begin.jikiscript"
        },
        {
          "match": "]",
          "name": "punctuation.section.accessor.end.jikiscript"
        },
        {
          "match": "\\(|\\)",
          "name": "punctuation.section.function.jikiscript"
        }
      ]
    },
    "param": {
      "match": "\\G(([_a-zA-Z]\\w*))",
      "captures": {
        "1": {
          "name": "punctuation.definition.constant.jikiscript"
        },
        "2": {
          "name": "variable.parameter.function.jikiscript"
        }
      }
    },
    "illegal": {
      "comment": "everything being a reserved word used outside of context is illegal",
      "match": "\\b(change|set|new|class|public|private|method|this|constructor|property|repeat|times|repeat_until_game_over|repeat_forever|for|indexed|by|each|in|with|to|return|if|else|unless|end|do|break|continue|next|return)\\b",
      "name": "invalid.illegal.jikiscript"
    },
    "control.enumeration": {
      "comment": "usable inside enumeration",
      "name": "keyword.control.pseudo-method.jikiscript",
      "match": "\\b(break|next|continue)\\b"
    },
    "control.functions": {
      "comment": "usable inside functions",
      "patterns": [
        {
          "comment": "everything after a return until a newline, or dict syntax is the return expression",
          "match": "\\b(return)\\s+(?=[{\\w+])",
          "captures": {
            "1": {
              "name": "keyword.control.pseudo-method.jikiscript"
            }
          },
          "name": "meta.function.return.expression.jikiscript"
        },
        {
          "match": "\\b(return)\\b",
          "captures": {
            "1": {
              "name": "keyword.control.pseudo-method.jikiscript"
            }
          },
          "name": "meta.function.return.void.jikiscript"
        }
      ]
    },
    "support.functions": {
      "comment": "built in library, sometimes conditional to the exercise",
      "begin": "\\b((log|join|concatenate|push|concat|number_to_string|string_to_number|to_upper_case|to_lower_case|has_key|keys|min|max))(\\()",
      "end": "(\\))",
      "beginCaptures": {
        "1": {
          "name": "support.function.jikiscript"
        },
        "2": {
          "name": "entity.name.function.jikiscript"
        },
        "3": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "patterns": [
        {
          "include": "#expression"
        }
      ],
      "name": "meta.scope-default.function-call.jikiscript"
    },
    "support.functions.instance": {
      "comment": "built in library, sometimes conditional to the exercise, with access to this references",
      "begin": "\\b((log|join|concatenate|push|concat|number_to_string|string_to_number|to_upper_case|to_lower_case|has_key|keys|min|max))(\\()",
      "end": "(\\))",
      "beginCaptures": {
        "1": {
          "name": "support.function.jikiscript"
        },
        "2": {
          "name": "entity.name.function.jikiscript"
        },
        "3": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "patterns": [
        {
          "include": "#expression.instance"
        }
      ],
      "name": "meta.scope-instance.function-call.jikiscript"
    },
    "support.functions.drawing": {
      "comment": "built in drawing library, sometimes conditional to the exercise",
      "begin": "\\b(clear|rectangle|triangle|circle|ellipse|line|write|fill_color_hex|fill_color_rgb|fill_color_rgba|fill_color_hsl|stroke_width|stroke_color_hex|get_shot_length|fire_fireworks)(\\()",
      "end": "(\\))",
      "beginCaptures": {
        "1": {
          "name": "support.function.jikiscript"
        },
        "2": {
          "name": "entity.name.function.jikiscript"
        },
        "3": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "patterns": [
        {
          "include": "#expression"
        }
      ],
      "name": "meta.scope-default.function-call.jikiscript"
    },
    "support.functions.drawing.instance": {
      "comment": "built in drawing library, sometimes conditional to the exercise, with access to this references",
      "begin": "\\b(clear|rectangle|triangle|circle|ellipse|line|write|fill_color_hex|fill_color_rgb|fill_color_rgba|fill_color_hsl|stroke_width|stroke_color_hex|get_shot_length|fire_fireworks)(\\()",
      "end": "(\\))",
      "beginCaptures": {
        "1": {
          "name": "support.function.jikiscript"
        },
        "2": {
          "name": "entity.name.function.jikiscript"
        },
        "3": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "patterns": [
        {
          "include": "#expression.instance"
        }
      ],
      "name": "meta.scope-instance.function-call.jikiscript"
    },
    "statements.variable.assignment.local": {
      "patterns": [
        {
          "include": "#statements.variable.declaration.local"
        },
        {
          "include": "#statements.variable.reassignment.local"
        }
      ]
    },
    "statements.variable.declaration.local": {
      "begin": "^\\s*(set)\\s+",
      "end": "\\b(to)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.jikiscript"
        }
      },
      "contentName": "meta.variable.assignment.subject.jikiscript",
      "endCaptures": {
        "1": {
          "name": "keyword.control.jikiscript"
        }
      },
      "comment": "A local variable declaration with assignment",
      "name": "meta.variable.assignment.jikiscript",
      "patterns": [
        {
          "match": "\\G(this\\.)?(?:([a-z](?:[A-Za-z0-9_])*)(\\.))*([a-z](?:[A-Za-z0-9_])*)",
          "captures": {
            "1": { "name": "invalid.illegal" },
            "2": { "name": "variable.name.jikiscript" },
            "3": { "name": "punctuation.object.accessor.jikiscript" },
            "4": { "name": "variable.name.jikiscript" }
          }
        },
        {
          "begin": "(?<!\\s)(\\[)",
          "end": "(\\])\\s+",
          "beginCaptures": {
            "1": {
              "name": "punctuation.section.accessor.begin.jikiscript"
            }
          },
          "endCaptures": {
            "1": {
              "name": "punctuation.section.accessor.end.jikiscript"
            }
          },
          "contentName": "meta.variable.accessor.javascript",
          "patterns": [
            {
              "include": "#expression"
            }
          ]
        }
      ]
    },
    "statements.variable.initialization.instance": {
      "comment": "A local variable declaration with assignment inside class definitions",
      "begin": "^\\s*(set)\\s+",
      "end": "\\b(to)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.jikiscript"
        }
      },
      "contentName": "meta.variable.assignment.subject.jikiscript",
      "endCaptures": {
        "1": {
          "name": "keyword.control.jikiscript"
        }
      },
      "name": "meta.variable.assignment.jikiscript",
      "patterns": [
        {
          "match": "\\G(this\\.)?(?:([a-z](?:[A-Za-z0-9_])*)(\\.))*([a-z](?:[A-Za-z0-9_])*)",
          "captures": {
            "1": { "name": "variable.language.this.jikiscript" },
            "2": { "name": "variable.name.jikiscript" },
            "3": { "name": "punctuation.object.accessor.jikiscript" },
            "4": { "name": "variable.name.jikiscript" }
          }
        },
        {
          "begin": "(?<!\\s)(\\[)",
          "end": "(\\])\\s+",
          "beginCaptures": {
            "1": {
              "name": "punctuation.section.accessor.begin.jikiscript"
            }
          },
          "endCaptures": {
            "1": {
              "name": "punctuation.section.accessor.end.jikiscript"
            }
          },
          "contentName": "meta.variable.accessor.javascript",
          "patterns": [
            {
              "include": "#expression"
            }
          ]
        }
      ]
    },
    "statements.variable.reassignment.local": {
      "comment": "A local variable declaration with assignment",
      "begin": "^\\s*(change)\\s+",
      "end": "\\b(to)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.jikiscript"
        }
      },
      "contentName": "meta.variable.assignment.subject.jikiscript",
      "endCaptures": {
        "1": {
          "name": "keyword.control.jikiscript"
        }
      },
      "name": "meta.variable.assignment.jikiscript",
      "patterns": [
        {
          "match": "\\G(this\\.)?(?:([a-z](?:[A-Za-z0-9_])*)(\\.))*([a-z](?:[A-Za-z0-9_])*)",
          "captures": {
            "1": { "name": "invalid.illegal" },
            "2": { "name": "variable.name.jikiscript" },
            "3": { "name": "punctuation.object.accessor.jikiscript" },
            "4": { "name": "variable.name.jikiscript" }
          }
        },
        {
          "begin": "(?<!\\s)(\\[)",
          "end": "(\\])\\s+",
          "beginCaptures": {
            "1": {
              "name": "punctuation.section.accessor.begin.jikiscript"
            }
          },
          "endCaptures": {
            "1": {
              "name": "punctuation.section.accessor.end.jikiscript"
            }
          },
          "contentName": "meta.variable.accessor.javascript",
          "patterns": [
            {
              "include": "#expression"
            }
          ]
        }
      ]
    },
    "statements.variable.reassignment.instance": {
      "comment": "A local variable declaration with assignment inside class definitions",
      "begin": "^\\s*(change)\\s+",
      "end": "\\b(to)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.jikiscript"
        }
      },
      "contentName": "meta.variable.assignment.subject.jikiscript",
      "endCaptures": {
        "1": {
          "name": "keyword.control.jikiscript"
        }
      },
      "name": "meta.variable.assignment.jikiscript",
      "patterns": [
        {
          "match": "\\G(this\\.)?(?:([a-z](?:[A-Za-z0-9_])*)(\\.))*([a-z](?:[A-Za-z0-9_])*)",
          "captures": {
            "1": { "name": "variable.language.this.jikiscript" },
            "2": { "name": "variable.name.jikiscript" },
            "3": { "name": "punctuation.object.accessor.jikiscript" },
            "4": { "name": "variable.name.jikiscript" }
          }
        },
        {
          "begin": "(?<!\\s)(\\[)",
          "end": "(\\])\\s+",
          "beginCaptures": {
            "1": {
              "name": "punctuation.section.accessor.begin.jikiscript"
            }
          },
          "endCaptures": {
            "1": {
              "name": "punctuation.section.accessor.end.jikiscript"
            }
          },
          "contentName": "meta.variable.accessor.javascript",
          "patterns": [
            {
              "include": "#expression"
            }
          ]
        }
      ]
    },
    "statements.class.definition": {
      "comment": "class definition",
      "begin": "^\\s*(class)\\s+",
      "end": "^\\b(end)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.class.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.class.jikiscript",
      "patterns": [
        {
          "comment": "class my#FooBar",
          "match": "(?<=\\bclass\\s+)((((?:((my)|(?:[a-z][a-zA-Z0-9_]*))(#))?([A-Z][a-zA-Z0-9_]*))))\\s*(?=do)",
          "captures": {
            "1": {
              "name": "meta.class.identifier.jikiscript"
            },
            "2": {
              "name": "entity.name.type.class.jikiscript"
            },
            "4": {
              "name": "meta.class.namespace.jikiscript"
            },
            "5": {
              "name": "support.constant.my.jikiscript"
            },
            "6": {
              "name": "punctuation.separator.namespace.jikiscript"
            },
            "7": {
              "name": "meta.class.name.jikiscript"
            }
          }
        },
        {
          "comment": "class body",
          "begin": "(?<=\\bclass\\s+.*?)\\b(do)\\b",
          "end": "\\b(?=end\\b)",
          "beginCaptures": {
            "1": {
              "name": "keyword.control.start-block.jikiscript"
            }
          },
          "contentName": "meta.class.body.jikiscript",
          "patterns": [
            {
              "include": "#statements.class.property"
            },
            {
              "include": "#statements.class.constructor"
            },
            {
              "include": "#statements.class.method"
            },
            {
              "include": "#comments"
            },
            {
              "comment": "nested functions are illegal",
              "match": "\\bfunction\\b",
              "name": "invalid.illegal.jikiscript"
            },
            {
              "include": "#illegal"
            }
          ]
        }
      ]
    },
    "statements.class.property": {
      "comment": "class instance property declaration",
      "match": "^\\s*(public|private)\\s+(property)\\s+([a-z][_A-Za-z0-9]*)\\b",
      "name": "meta.class.property.declaration.jikiscript",
      "captures": {
        "1": {
          "name": "storage.type.modifier.encapsulation.jikiscript"
        },
        "2": {
          "name": "keyword.other.property.jikiscript"
        },
        "3": {
          "name": "variable.other.property.jikiscript"
        }
      }
    },
    "statements.class.constructor": {
      "comment": "class constructor",
      "begin": "^\\s*(constructor)\\b",
      "end": "\\b(end)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.other.constructor.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.class.constructor.jikiscript",
      "patterns": [
        {
          "include": "#statements.function.parameters"
        },
        {
          "begin": "\\b(do)\\b",
          "end": "\\b(?=end\\b)",
          "beginCaptures": {
            "1": {
              "name": "keyword.control.start-block.jikiscript"
            }
          },
          "patterns": [
            {
              "include": "#scopes.constructor"
            }
          ]
        }
      ]
    },
    "statements.class.method": {
      "comment": "class instance method",
      "begin": "^\\s*(public|private)\\s+(method)\\b",
      "end": "\\b(end)\\b",
      "beginCaptures": {
        "1": {
          "name": "storage.type.modifier.encapsulation.jikiscript"
        },
        "2": {
          "name": "keyword.other.method.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.class.method.jikiscript",
      "patterns": [
        {
          "match": "\\G\\s+(([a-z][_A-Za-z0-9]*))\\s+",
          "captures": {
            "1": {
              "name": "meta.function.name.jikiscript"
            },
            "2": {
              "name": "entity.name.function.jikiscript"
            }
          }
        },
        {
          "include": "#statements.function.parameters"
        },
        {
          "begin": "\\b(do)\\b",
          "end": "\\b(?=end\\b)",
          "beginCaptures": {
            "1": {
              "name": "keyword.control.start-block.jikiscript"
            }
          },
          "patterns": [
            {
              "include": "#scopes.method"
            }
          ]
        }
      ]
    },
    "statements.function.definition": {
      "comment": "function definitions",
      "begin": "^(?=function\\s+)",
      "end": "\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.function.jikiscript",
      "patterns": [
        {
          "begin": "\\G(function)\\s+",
          "end": "\\b(do)|\\n|$",
          "beginCaptures": {
            "1": {
              "name": "keyword.control.function.jikiscript"
            }
          },
          "endCaptures": {
            "1": {
              "name": "keyword.control.start-block.jikiscript"
            }
          },
          "contentName": "meta.function.signature.jikiscript",
          "patterns": [
            {
              "match": "\\G((my)(#))?(([a-z][_a-zA-Z0-9]*))\\s+(?=with|do)",
              "name": "meta.function.identifier.jikiscript",
              "captures": {
                "1": {
                  "name": "meta.function.namespace.jikiscript"
                },
                "2": {
                  "name": "support.constant.my.jikiscript"
                },
                "3": {
                  "name": "punctuation.separator.namespace.jikiscript"
                },
                "4": {
                  "name": "meta.function.name.jikiscript"
                },
                "5": {
                  "name": "entity.name.function.jikiscript"
                }
              }
            },
            {
              "include": "#statement.function.parameters"
            }
          ]
        },
        {
          "include": "#scopes.function"
        }
      ]
    },
    "statements.function.parameters": {
      "begin": "\\b(with)\\s+",
      "end": "\\s+(?=do\\b)",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.with.jikiscript"
        }
      },
      "contentName": "meta.function.parameters.jikiscript",
      "patterns": [
        {
          "begin": "(?=[_a-zA-Z])",
          "end": "(?=(,|\\s+do))",
          "contentName": "meta.function.parameter.jikiscript",
          "patterns": [
            {
              "include": "#param"
            }
          ]
        }
      ]
    },
    "statements.instance-creation": {
      "comment": "new instance creation",
      "begin": "(?<![_\\.#])\\b(new)\\s+((my)(#))?([a-zA-Z]\\w*[!?]?)(\\()",
      "end": "(\\))",
      "beginCaptures": {
        "1": {
          "name": "keyword.other.special-method.jikiscript"
        },
        "2": {
          "name": "meta.class.namespace.jikiscript"
        },
        "3": {
          "name": "support.constant.my.jikiscript"
        },
        "4": {
          "name": "punctuation.separator.namespace.jikiscript"
        },
        "5": {
          "name": "entity.name.type.class.jikiscript"
        },
        "6": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "name": "meta.scope-default.instance-creation.jikiscript",
      "patterns": [
        {
          "include": "#expression"
        }
      ]
    },
    "statements.instance-creation.instance": {
      "comment": "new instance creation with access to this",
      "begin": "(?<![_\\.#])\\b(new)\\s+((my)(#))?([a-zA-Z]\\w*[!?]?)(\\()",
      "end": "(\\))",
      "beginCaptures": {
        "1": {
          "name": "keyword.other.special-method.jikiscript"
        },
        "2": {
          "name": "meta.class.namespace.jikiscript"
        },
        "3": {
          "name": "support.constant.my.jikiscript"
        },
        "4": {
          "name": "punctuation.separator.namespace.jikiscript"
        },
        "5": {
          "name": "entity.name.type.class.jikiscript"
        },
        "6": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "name": "meta.scope-instance.instance-creation.jikiscript",
      "patterns": [
        {
          "include": "#expression.instance"
        }
      ]
    },
    "statements.function-call": {
      "comment": "function call",
      "begin": "((my)(#))?([a-zA-Z]\\w*[!?]?)(\\()",
      "end": "(\\))",
      "beginCaptures": {
        "1": {
          "name": "meta.function.namespace.jikiscript"
        },
        "2": {
          "name": "support.constant.my.jikiscript"
        },
        "3": {
          "name": "punctuation.separator.namespace.jikiscript"
        },
        "4": {
          "name": "entity.name.function.jikiscript"
        },
        "5": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "name": "meta.scope-default.function-call.jikiscript",
      "patterns": [
        {
          "include": "#expression"
        }
      ]
    },
    "statements.function-call.instance": {
      "comment": "function call with access to this",
      "begin": "((my)(#))?([a-zA-Z]\\w*[!?]?)(\\()",
      "end": "(\\))",
      "beginCaptures": {
        "1": {
          "name": "meta.function.namespace.jikiscript"
        },
        "2": {
          "name": "support.constant.my.jikiscript"
        },
        "3": {
          "name": "punctuation.separator.namespace.jikiscript"
        },
        "4": {
          "name": "entity.name.function.jikiscript"
        },
        "5": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "punctuation.section.function.jikiscript"
        }
      },
      "name": "meta.scope-instance.function-call.jikiscript",
      "patterns": [
        {
          "include": "#expression.instance"
        }
      ]
    },
    "statements.method-call": {
      "comment": "method call",
      "begin": "(?<=[^\\.]\\.)(?=[a-zA-Z][a-zA-Z0-9_]*\\()",
      "end": "\\(",
      "name": "meta.method-call.jikiscript",
      "patterns": [
        {
          "name": "entity.name.function.jikiscript",
          "match": "([a-zA-Z][a-zA-Z0-9_!?]*)(?=[^a-zA-Z0-9_!?])"
        }
      ]
    },
    "statements.instance.method-call": {
      "comment": "object instance method call",
      "begin": "(?<![_\\.#])\\b((this)\\.)(?=[a-zA-Z][a-zA-Z0-9_!?]*\\()",
      "end": "\\(",
      "beginCaptures": {
        "1": {
          "name": "variable.language.this.jikiscript"
        }
      },
      "name": "meta.method-call.jikiscript",
      "patterns": [
        {
          "name": "entity.name.function.jikiscript",
          "match": "([a-zA-Z][a-zA-Z0-9_!?]*)"
        }
      ]
    },
    "statements.conditional.top": {
      "begin": "^\\s*(?=(?:if|unless)\\s+)",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-top.conditional.jikiscript",
      "patterns": [
        {
          "include": "#statements.conditional.if.top"
        },
        {
          "include": "#statements.conditional.unless.top"
        },
        {
          "include": "#statements.conditional.body.top"
        }
      ]
    },
    "statements.conditional.top-loop": {
      "comment": "conditional statements with access to loop keywords",
      "begin": "^\\s*(?=(?:if|unless)\\s+)",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-top-loop.conditional.jikiscript",
      "patterns": [
        {
          "include": "#statements.conditional.if.top"
        },
        {
          "include": "#statements.conditional.unless.top"
        },
        {
          "include": "#statements.conditional.body.top-loop"
        }
      ]
    },
    "statements.conditional.function": {
      "comment": "conditional statements with access to function keywords",
      "begin": "^\\s*(?=(?:if|unless)\\s+)",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-function.conditional.jikiscript",
      "patterns": [
        {
          "include": "#statements.conditional.if.instance"
        },
        {
          "include": "#statements.conditional.unless.instance"
        },
        {
          "include": "#statements.conditional.body.function"
        }
      ]
    },
    "statements.conditional.function-loop": {
      "comment": "conditional statements with access to function and loop keywords",
      "begin": "^\\s*(?=(?:if|unless)\\s+)",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-function-loop.conditional.jikiscript",
      "patterns": [
        {
          "include": "#statements.conditional.if.instance"
        },
        {
          "include": "#statements.conditional.unless.instance"
        },
        {
          "include": "#statements.conditional.body.function-loop"
        }
      ]
    },
    "statements.conditional.constructor": {
      "comment": "conditional statements with access to this references and method keywords, in the constructor",
      "begin": "^\\s*(?=(?:if|unless)\\s+)",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-constructor.conditional.jikiscript",
      "patterns": [
        {
          "include": "#statements.conditional.if.instance"
        },
        {
          "include": "#statements.conditional.unless.instance"
        },
        {
          "include": "#statements.conditional.body.constructor"
        }
      ]
    },
    "statements.conditional.constructor-loop": {
      "comment": "conditional statements with access to this references and method & loop keywords, in the constructor",
      "begin": "^\\s*(?=(?:if|unless)\\s+)",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-constructor-loop.conditional.jikiscript",
      "patterns": [
        {
          "include": "#statements.conditional.if.instance"
        },
        {
          "include": "#statements.conditional.unless.instance"
        },
        {
          "include": "#statements.conditional.body.constructor-loop"
        }
      ]
    },
    "statements.conditional.method": {
      "comment": "conditional statements with access to this references and method keywords, in a method",
      "begin": "^\\s*(?=(?:if|unless)\\s+)",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-method.conditional.jikiscript",
      "patterns": [
        {
          "include": "#statements.conditional.if.instance"
        },
        {
          "include": "#statements.conditional.unless.instance"
        },
        {
          "include": "#statements.conditional.body.method"
        }
      ]
    },
    "statements.conditional.method-loop": {
      "comment": "conditional statements with access to this references and method & loop keywords, in a method",
      "begin": "^\\s*(?=(?:if|unless)\\s+)",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-method-loop.conditional.jikiscript",
      "patterns": [
        {
          "include": "#statements.conditional.if.instance"
        },
        {
          "include": "#statements.conditional.unless.instance"
        },
        {
          "include": "#statements.conditional.body.method-loop"
        }
      ]
    },
    "statements.conditional.if.top": {
      "comment": "conditional if statements",
      "begin": "\\b(if)\\s+",
      "end": "\\s+(do)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.conditional.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.start-block.jikiscript"
        }
      },
      "name": "meta.scope-top.conditional.if.jikiscript",
      "contentName": "meta.scope-top.conditional.expression.jikiscript",
      "patterns": [
        {
          "include": "#expression.top"
        }
      ]
    },
    "statements.conditional.if.instance": {
      "comment": "conditional if statements with access to this references",
      "begin": "\\b(if)\\s+",
      "end": "\\s+(do)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.conditional.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.start-block.jikiscript"
        }
      },
      "name": "meta.scope-instance.conditional.if.jikiscript",
      "contentName": "meta.conditional.expression.jikiscript",
      "patterns": [
        {
          "include": "#expression.instance"
        }
      ]
    },
    "statements.conditional.unless.top": {
      "comment": "conditional unless statements",
      "begin": "\\b(unless)\\s+",
      "end": "\\s+(do)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.conditional.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.start-block.jikiscript"
        }
      },
      "name": "meta.scope-top.conditional.unless.jikiscript",
      "contentName": "meta.scope-top.conditional.expression.jikiscript",
      "patterns": [
        {
          "include": "#expression.top"
        }
      ]
    },
    "statements.conditional.unless.instance": {
      "comment": "conditional unless statements with access to this references",
      "begin": "\\b(unless)\\s+",
      "end": "\\s+(do)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.conditional.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.start-block.jikiscript"
        }
      },
      "name": "meta.scope-instance.conditional.unless.jikiscript",
      "contentName": "meta.conditional.expression.jikiscript",
      "patterns": [
        {
          "include": "#expression.instance"
        }
      ]
    },
    "statements.conditional.body.top": {
      "comment": "body of a conditional statement (between do and end)",
      "patterns": [
        {
          "include": "#statements.conditional.else-if.top"
        },
        {
          "include": "#statements.conditional.else.any"
        },
        {
          "include": "#scopes.top.nested"
        }
      ]
    },
    "statements.conditional.body.top-loop": {
      "comment": "body of a conditional statement (between do and end) with access to loop keywords",
      "patterns": [
        {
          "include": "#statements.conditional.else-if.instance"
        },
        {
          "include": "#statements.conditional.else.any"
        },
        {
          "include": "#scopes.top.loop"
        }
      ]
    },
    "statements.conditional.body.constructor": {
      "comment": "body of a conditional statement (between do and end) with access to this references, in the constructor",
      "patterns": [
        {
          "include": "#statements.conditional.else-if.instance"
        },
        {
          "include": "#statements.conditional.else.any"
        },
        {
          "include": "#scopes.constructor.nested"
        }
      ]
    },
    "statements.conditional.body.constructor-loop": {
      "comment": "body of a conditional statement (between do and end) with access to this references and loop keywords, in the constructor",
      "patterns": [
        {
          "include": "#statements.conditional.else-if.instance"
        },
        {
          "include": "#statements.conditional.else.any"
        },
        {
          "include": "#scopes.constructor.loop"
        }
      ]
    },
    "statements.conditional.body.method": {
      "comment": "body of a conditional statement (between do and end) with access to this references, in any method",
      "patterns": [
        {
          "include": "#statements.conditional.else-if.instance"
        },
        {
          "include": "#statements.conditional.else.any"
        },
        {
          "include": "#scopes.method.nested"
        }
      ]
    },
    "statements.conditional.body.method-loop": {
      "comment": "body of a conditional statement (between do and end) with access to this references and loop keywords, in any method",
      "patterns": [
        {
          "include": "#statements.conditional.else-if.instance"
        },
        {
          "include": "#statements.conditional.else.any"
        },
        {
          "include": "#scopes.method.loop"
        }
      ]
    },
    "statements.conditional.body.function": {
      "comment": "body of a conditional statement (between do and end) with access to function keywords",
      "patterns": [
        {
          "include": "#statements.conditional.else-if.instance"
        },
        {
          "include": "#statements.conditional.else.any"
        },
        {
          "include": "#scopes.function.nested"
        }
      ]
    },
    "statements.conditional.body.function-loop": {
      "comment": "body of a conditional statement (between do and end) with access to function and loop keywords",
      "patterns": [
        {
          "include": "#statements.conditional.else-if.instance"
        },
        {
          "include": "#statements.conditional.else.any"
        },
        {
          "include": "#scopes.function.loop"
        }
      ]
    },
    "statements.conditional.else-if.top": {
      "begin": "\\b(else)\\s+((if))\\s+",
      "end": "\\s+(do)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.conditional.jikiscript"
        },
        "2": {
          "name": "keyword.control.conditional.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.start-block.jikiscript"
        }
      },
      "contentName": "meta.scope-top.conditional.if.expression.jikiscript",
      "patterns": [
        {
          "include": "#expression.top"
        }
      ]
    },
    "statements.conditional.else-if.instance": {
      "begin": "\\b(else)\\s+((if))\\s+",
      "end": "\\s+(do)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.conditional.jikiscript"
        },
        "2": {
          "name": "keyword.control.conditional.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.start-block.jikiscript"
        }
      },
      "contentName": "meta.scope-instance.conditional.if.expression.jikiscript",
      "patterns": [
        {
          "include": "#expression.instance"
        }
      ]
    },
    "statements.conditional.else.any": {
      "match": "\\b(else)\\s+(do)\\b",
      "captures": {
        "1": {
          "name": "keyword.control.conditional.jikiscript"
        },
        "2": {
          "name": "keyword.control.start-block.jikiscript"
        }
      }
    },
    "statements.for-each.top": {
      "comment": "for each enumeration",
      "begin": "^\\s*(for)\\s+(each)\\s+",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.enumerable.jikiscript"
        },
        "2": {
          "name": "keyword.control.enumerable.jikiscript"
        },
        "3": {
          "name": "variable.other.enumerable.current.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-top.enumerable.for-each.jikiscript",
      "patterns": [
        {
          "match": "\\G([a-z][_A-Za-z0-9]*)\\s+",
          "captures": {
            "1": {
              "name": "variable.name.jikiscript"
            }
          }
        },
        {
          "begin": "(in)\\s+",
          "end": "\\s+(do)\\b",
          "beginCaptures": {
            "1": {
              "name": "keyword.control.enumerable.jikiscript"
            }
          },
          "endCaptures": {
            "1": {
              "name": "keyword.control.start-block.jikiscript"
            }
          },
          "patterns": [
            {
              "match": "\\b(indexed\\s+by)\\s+([a-z][_A-Za-z0-9]*)\\b",
              "name": "meta.scope-top.enumerable.indexed-by.jikiscript",
              "captures": {
                "1": {
                  "name": "keyword.control.enumerable.jikiscript"
                },
                "2": {
                  "name": "variable.other.enumerable.index.jikiscript"
                }
              }
            },
            {
              "include": "#expression.top",
              "name": "meta.enumerable.subject.jikiscript"
            }
          ]
        },
        {
          "include": "#scopes.top.loop"
        }
      ]
    },
    "statements.for-each.constructor": {
      "comment": "for each enumeration with access to this references and method keywords, in the constructor",
      "begin": "^\\s*(for)\\s+(each)\\s+",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.enumerable.jikiscript"
        },
        "2": {
          "name": "keyword.control.enumerable.jikiscript"
        },
        "3": {
          "name": "variable.other.enumerable.current.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-constructor.enumerable.for-each.jikiscript",
      "patterns": [
        {
          "match": "\\G([a-z][_A-Za-z0-9]*)\\s+",
          "captures": {
            "1": {
              "name": "variable.name.jikiscript"
            }
          }
        },
        {
          "begin": "(in)\\s+",
          "end": "\\s+(do)\\b",
          "beginCaptures": {
            "1": {
              "name": "keyword.control.enumerable.jikiscript"
            }
          },
          "endCaptures": {
            "1": {
              "name": "keyword.control.start-block.jikiscript"
            }
          },
          "patterns": [
            {
              "match": "\\b(indexed\\s+by)\\s+([a-z][_A-Za-z0-9]*)\\b",
              "name": "meta.scope-constructor.enumerable.indexed-by.jikiscript",
              "captures": {
                "1": {
                  "name": "keyword.control.enumerable.jikiscript"
                },
                "2": {
                  "name": "variable.other.enumerable.index.jikiscript"
                }
              }
            },
            {
              "include": "#expression.instance",
              "name": "meta.enumerable.subject.jikiscript"
            }
          ]
        },
        {
          "include": "#scopes.constructor.loop"
        }
      ]
    },
    "statements.for-each.method": {
      "comment": "for each enumeration with access to this references and method keywords, in any method",
      "begin": "^\\s*(for)\\s+(each)\\s+",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.enumerable.jikiscript"
        },
        "2": {
          "name": "keyword.control.enumerable.jikiscript"
        },
        "3": {
          "name": "variable.other.enumerable.current.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-method.enumerable.for-each.jikiscript",
      "patterns": [
        {
          "match": "\\G([a-z][_A-Za-z0-9]*)\\s+",
          "captures": {
            "1": {
              "name": "variable.name.jikiscript"
            }
          }
        },
        {
          "begin": "(in)\\s+",
          "end": "\\s+(do)\\b",
          "beginCaptures": {
            "1": {
              "name": "keyword.control.enumerable.jikiscript"
            }
          },
          "endCaptures": {
            "1": {
              "name": "keyword.control.start-block.jikiscript"
            }
          },
          "patterns": [
            {
              "match": "\\b(indexed\\s+by)\\s+([a-z][_A-Za-z0-9]*)\\b",
              "name": "meta.scope-method.enumerable.indexed-by.jikiscript",
              "captures": {
                "1": {
                  "name": "keyword.control.enumerable.jikiscript"
                },
                "2": {
                  "name": "variable.other.enumerable.index.jikiscript"
                }
              }
            },
            {
              "include": "#expression.instance",
              "name": "meta.enumerable.subject.jikiscript"
            }
          ]
        },
        {
          "include": "#scopes.method.loop"
        }
      ]
    },
    "statements.for-each.function": {
      "comment": "for each enumeration with access to function keywords",
      "begin": "^\\s*(for)\\s+(each)\\s+",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.enumerable.jikiscript"
        },
        "2": {
          "name": "keyword.control.enumerable.jikiscript"
        },
        "3": {
          "name": "variable.other.enumerable.current.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-function.enumerable.for-each.jikiscript",
      "patterns": [
        {
          "match": "\\G([a-z][_A-Za-z0-9]*)\\s+",
          "captures": {
            "1": {
              "name": "variable.name.jikiscript"
            }
          }
        },
        {
          "begin": "(in)\\s+",
          "end": "\\s+(do)\\b",
          "beginCaptures": {
            "1": {
              "name": "keyword.control.enumerable.jikiscript"
            }
          },
          "endCaptures": {
            "1": {
              "name": "keyword.control.start-block.jikiscript"
            }
          },
          "patterns": [
            {
              "match": "\\b(indexed\\s+by)\\s+([a-z][_A-Za-z0-9]*)\\b",
              "name": "meta.scope-function.enumerable.indexed-by.jikiscript",
              "captures": {
                "1": {
                  "name": "keyword.control.enumerable.jikiscript"
                },
                "2": {
                  "name": "variable.other.enumerable.index.jikiscript"
                }
              }
            },
            {
              "include": "#expression.top",
              "name": "meta.enumerable.subject.jikiscript"
            }
          ]
        },
        {
          "include": "#scopes.function.loop"
        }
      ]
    },
    "statements.loop.top": {
      "begin": "^\\s*(?=(?:repeat|repeat_forever|repeat_until_game_over)\\s+)",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-top.loop.jikiscript",
      "patterns": [
        {
          "include": "#statements.loop.repeat.support.any"
        },
        {
          "include": "#statements.loop.repeat.times.top"
        },
        {
          "include": "#scopes.top.loop"
        }
      ]
    },
    "statements.loop.constructor": {
      "comment": "repeat loops with access to this references and method keywords, in the constructor",
      "begin": "^\\s*(?=(?:repeat|repeat_forever|repeat_until_game_over)\\s+)",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-constructor.loop.jikiscript",
      "patterns": [
        {
          "include": "#statements.loop.repeat.support.any"
        },
        {
          "include": "#statements.loop.repeat.times.instance"
        },
        {
          "include": "#scopes.constructor.loop"
        }
      ]
    },
    "statements.loop.method": {
      "comment": "repeat loops with access to this references and method keywords, in any method",
      "begin": "^\\s*(?=(?:repeat|repeat_forever|repeat_until_game_over)\\s+)",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-method.loop.jikiscript",
      "patterns": [
        {
          "include": "#statements.loop.repeat.support.any"
        },
        {
          "include": "#statements.loop.repeat.times.instance"
        },
        {
          "include": "#scopes.method.loop"
        }
      ]
    },
    "statements.loop.function": {
      "comment": "repeat loops with access to function keywords",
      "begin": "^\\s*(?=(?:repeat|repeat_forever|repeat_until_game_over)\\s+)",
      "end": "(?<![_\\.#])\\b(end)\\b",
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.scope-function.loop.jikiscript",
      "patterns": [
        {
          "include": "#statements.loop.repeat.times.top"
        },
        {
          "include": "#statements.loop.repeat.support.any"
        },
        {
          "include": "#scopes.function.loop"
        }
      ]
    },
    "statements.loop.repeat.times.top": {
      "comment": "repeat n times loop statement",
      "begin": "\\G(repeat)\\s+",
      "end": "\\b(do)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.loop.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.start-block.jikiscript"
        }
      },
      "patterns": [
        {
          "begin": "\\G",
          "end": "\\b(times)\\s+",
          "endCaptures": {
            "1": {
              "name": "keyword.control.loop.jikiscript"
            }
          },
          "patterns": [
            {
              "include": "#expression.top"
            }
          ]
        },
        {
          "match": "(indexed\\s+by)\\s+((do)|(?:[a-z][_A-Za-z0-9]*))\\b\\s+",
          "captures": {
            "1": {
              "name": "keyword.control.loops.jikiscript"
            },
            "2": {
              "name": "variable.other.loops.index.jikiscript"
            },
            "3": {
              "name": "invalid.illegal"
            }
          },
          "name": "meta.loops.indexed-by.jikiscript"
        }
      ]
    },
    "statements.loop.repeat.times.instance": {
      "comment": "repeat n times loop statement with access to this references and method keywords",
      "begin": "\\G(repeat)\\s+",
      "end": "\\b(do)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.loop.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.start-block.jikiscript"
        }
      },
      "patterns": [
        {
          "begin": "\\G",
          "end": "\\b(times)\\s+",
          "endCaptures": {
            "1": {
              "name": "keyword.control.loop.jikiscript"
            }
          },
          "patterns": [
            {
              "include": "#expression.instance"
            }
          ]
        },
        {
          "match": "(indexed\\s+by)\\s+((do)|(?:[a-z][_A-Za-z0-9]*))\\b\\s+",
          "captures": {
            "1": {
              "name": "keyword.control.loops.jikiscript"
            },
            "2": {
              "name": "variable.other.loops.index.jikiscript"
            },
            "3": {
              "name": "invalid.illegal"
            }
          },
          "name": "meta.loops.indexed-by.jikiscript"
        }
      ]
    },
    "statements.loop.repeat.support.any": {
      "comment": "special loop statements",
      "begin": "\\G(repeat_forever|repeat_until_game_over)\\s+",
      "end": "\\b(do)\\b",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.loop.jikiscript"
        }
      },
      "endCaptures": {
        "1": {
          "name": "keyword.control.end-block.jikiscript"
        }
      },
      "name": "meta.loops.repeat-special.jikiscript",
      "patterns": [
        {
          "match": "(indexed\\s+by)\\s+((do)|(?:[a-z][_A-Za-z0-9]*))\\b\\s+",
          "captures": {
            "1": {
              "name": "keyword.control.loops.jikiscript"
            },
            "2": {
              "name": "variable.other.loops.index.jikiscript"
            },
            "3": {
              "name": "invalid.illegal"
            }
          },
          "name": "meta.loops.indexed-by.jikiscript"
        }
      ]
    },
    "property-access": {
      "comment": "object property access",
      "begin": "\\b((this)\\.)(?=[a-zA-Z][a-zA-Z0-9_]*(?=[^a-zA-Z0-9_\\(]))",
      "beginCaptures": {
        "1": {
          "name": "variable.language.this.jikiscript"
        }
      },
      "end": "(?=[^a-zA-Z0-9_!?\\(])",
      "name": "meta.property.jikiscript",
      "patterns": [
        {
          "name": "entity.name.variable.jikiscript",
          "match": "([a-zA-Z][a-zA-Z0-9_!?]*)(?=[^a-zA-Z0-9_!?\\(])"
        }
      ]
    },
    "this-access": {
      "comment": "this access",
      "match": "\\b((this)\\.)(?=[a-zA-Z][a-zA-Z0-9_])",
      "captures": {
        "1": {
          "name": "variable.language.this.jikiscript"
        }
      }
    },
    "expression.top": {
      "comment": "generic expression that disallows this references",
      "patterns": [
        { "include": "#literals" },
        { "include": "#statements.instance-creation" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions" },
        { "include": "#support.functions.drawing" },
        { "include": "#statements.function-call" },
        { "include": "#punctuation" },
        { "include": "#illegal" }
      ]
    },
    "expression.instance": {
      "comment": "generic expression that allows this references",
      "patterns": [
        { "include": "#this-access" },
        { "include": "#literals" },
        { "include": "#statements.instance-creation.instance" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions.instance" },
        { "include": "#support.functions.drawing.instance" },
        { "include": "#statements.function-call.instance" },
        { "include": "#punctuation" },
        { "include": "#illegal" }
      ]
    },
    "expression": {
      "comment": "generic expression",
      "patterns": [
        { "include": "#literals" },
        { "include": "#statements.instance-creation" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions" },
        { "include": "#support.functions.drawing" },
        { "include": "#statements.function-call" },
        { "include": "#punctuation" },
        { "include": "#illegal" }
      ]
    },
    "scopes.top": {
      "patterns": [
        { "include": "#literals" },
        { "include": "#comments" },
        { "include": "#statements.class.definition" },
        { "include": "#statements.function.definition" },
        { "include": "#statements.variable.assignment.local" },
        { "include": "#statements.for-each.top" },
        { "include": "#statements.conditional.top" },
        { "include": "#statements.loop.top" },
        { "include": "#statements.instance-creation" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions" },
        { "include": "#support.functions.drawing" },
        { "include": "#statements.function-call" },
        { "include": "#punctuation" },
        {
          "comment": "everything unmatched that's known is illegal",
          "include": "#illegal"
        }
      ]
    },
    "scopes.function": {
      "patterns": [
        {
          "comment": "nested functions or methods or class constructs are illegal",
          "match": "\\bfunction|class|private|public|constructor|property|method\\b",
          "name": "invalid.illegal.jikiscript"
        },

        { "include": "#control.functions" },

        { "include": "#literals" },
        { "include": "#comments" },
        { "include": "#statements.variable.assignment.local" },
        { "include": "#statements.for-each.function" },
        { "include": "#statements.conditional.function" },
        { "include": "#statements.loop.function" },
        { "include": "#statements.instance-creation.instance" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions" },
        { "include": "#support.functions.drawing" },
        { "include": "#statements.function-call" },
        { "include": "#punctuation" },
        {
          "comment": "everything unmatched that's known is illegal",
          "include": "#illegal"
        }
      ]
    },
    "scopes.constructor": {
      "patterns": [
        {
          "comment": "nested functions or methods or class constructs are illegal",
          "match": "\\bfunction|class|private|public|constructor|property|method\\b",
          "name": "invalid.illegal.jikiscript"
        },

        { "include": "#statements.variable.initialization.instance" },
        { "include": "#statements.variable.reassignment.instance" },
        { "include": "#statements.instance.method-call" },
        { "include": "#property-access" },
        { "include": "#control.functions" },

        { "include": "#literals" },
        { "include": "#comments" },
        { "include": "#statements.variable.assignment.local" },
        { "include": "#statements.for-each.constructor" },
        { "include": "#statements.conditional.constructor" },
        { "include": "#statements.loop.constructor" },
        { "include": "#statements.instance-creation.instance" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions.instance" },
        { "include": "#support.functions.drawing.instance" },
        { "include": "#statements.function-call.instance" },
        { "include": "#punctuation" },
        {
          "comment": "everything unmatched that's known is illegal",
          "include": "#illegal"
        }
      ]
    },
    "scopes.method": {
      "patterns": [
        {
          "comment": "nested functions or methods or class constructs are illegal",
          "match": "\\bfunction|class|private|public|constructor|property|method\\b",
          "name": "invalid.illegal.jikiscript"
        },

        { "include": "#statements.variable.reassignment.instance" },
        { "include": "#statements.instance.method-call" },
        { "include": "#property-access" },
        { "include": "#control.functions" },

        { "include": "#literals" },
        { "include": "#comments" },
        { "include": "#statements.variable.assignment.local" },
        { "include": "#statements.for-each.method" },
        { "include": "#statements.conditional.method" },
        { "include": "#statements.loop.method" },
        { "include": "#statements.instance-creation.instance" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions.instance" },
        { "include": "#support.functions.drawing.instance" },
        { "include": "#statements.function-call.instance" },
        { "include": "#punctuation" },
        {
          "comment": "everything unmatched that's known is illegal",
          "include": "#illegal"
        }
      ]
    },
    "scopes.top.loop": {
      "patterns": [
        {
          "comment": "nested functions or methods or class constructs are illegal",
          "match": "\\bfunction|class|private|public|constructor|property|method\\b",
          "name": "invalid.illegal.jikiscript"
        },

        { "include": "#control.enumeration" },

        { "include": "#literals" },
        { "include": "#comments" },
        { "include": "#statements.variable.assignment.local" },
        { "include": "#statements.for-each.top" },
        { "include": "#statements.conditional.top-loop" },
        { "include": "#statements.loop.top" },
        { "include": "#statements.instance-creation" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions" },
        { "include": "#support.functions.drawing" },
        { "include": "#statements.function-call" },
        { "include": "#punctuation" },
        {
          "comment": "everything unmatched that's known is illegal",
          "include": "#illegal"
        }
      ]
    },
    "scopes.top.nested": {
      "patterns": [
        {
          "comment": "nested functions or methods or class constructs are illegal",
          "match": "\\bfunction|class|private|public|constructor|property|method\\b",
          "name": "invalid.illegal.jikiscript"
        },

        { "include": "#literals" },
        { "include": "#comments" },
        { "include": "#statements.variable.assignment.local" },
        { "include": "#statements.for-each.top" },
        { "include": "#statements.conditional.top" },
        { "include": "#statements.top.loop" },
        { "include": "#statements.instance-creation" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions" },
        { "include": "#support.functions.drawing" },
        { "include": "#statements.function-call" },
        { "include": "#punctuation" },
        {
          "comment": "everything unmatched that's known is illegal",
          "include": "#illegal"
        }
      ]
    },
    "scopes.constructor.loop": {
      "patterns": [
        {
          "comment": "nested functions or methods or class constructs are illegal",
          "match": "\\bfunction|class|private|public|constructor|property|method\\b",
          "name": "invalid.illegal.jikiscript"
        },

        { "include": "#statements.variable.initialization.instance" },
        { "include": "#statements.variable.reassignment.instance" },
        { "include": "#statements.instance.method-call" },
        { "include": "#property-access" },
        { "include": "#control.functions" },

        { "include": "#control.enumeration" },

        { "include": "#literals" },
        { "include": "#comments" },
        { "include": "#statements.variable.assignment.local" },
        { "include": "#statements.for-each.constructor" },
        { "include": "#statements.conditional.constructor-loop" },
        { "include": "#statements.loop.constructor" },
        { "include": "#statements.instance-creation.instance" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions.instance" },
        { "include": "#support.functions.drawing.instance" },
        { "include": "#statements.function-call.instance" },
        { "include": "#punctuation" },
        {
          "comment": "everything unmatched that's known is illegal",
          "include": "#illegal"
        }
      ]
    },
    "scopes.constructor.nested": {
      "patterns": [
        {
          "comment": "nested functions or methods or class constructs are illegal",
          "match": "\\bfunction|class|private|public|constructor|property|method\\b",
          "name": "invalid.illegal.jikiscript"
        },

        { "include": "#statements.variable.initialization.instance" },
        { "include": "#statements.variable.reassignment.instance" },
        { "include": "#statements.instance.method-call" },
        { "include": "#property-access" },
        { "include": "#control.functions" },

        { "include": "#literals" },
        { "include": "#comments" },
        { "include": "#statements.variable.assignment.local" },
        { "include": "#statements.constructor.for-each" },
        { "include": "#statements.constructor.loop.conditional" },
        { "include": "#statements.constructor.loop" },
        { "include": "#statements.instance-creation.instance" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions.instance" },
        { "include": "#support.functions.drawing.instance" },
        { "include": "#statements.function-call.instance" },
        { "include": "#punctuation" },
        {
          "comment": "everything unmatched that's known is illegal",
          "include": "#illegal"
        }
      ]
    },
    "scopes.method.loop": {
      "patterns": [
        {
          "comment": "nested functions or methods or class constructs are illegal",
          "match": "\\bfunction|class|private|public|constructor|property|method\\b",
          "name": "invalid.illegal.jikiscript"
        },

        { "include": "#statements.variable.reassignment.instance" },
        { "include": "#statements.instance.method-call" },
        { "include": "#property-access" },
        { "include": "#control.functions" },
        { "include": "#control.enumeration" },

        { "include": "#literals" },
        { "include": "#comments" },
        { "include": "#statements.variable.assignment.local" },
        { "include": "#statements.for-each.method" },
        { "include": "#statements.conditional.method-loop" },
        { "include": "#statements.loop.method" },
        { "include": "#statements.instance-creation.instance" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions.instance" },
        { "include": "#support.functions.drawing.instance" },
        { "include": "#statements.function-call.instance" },
        { "include": "#punctuation" },
        {
          "comment": "everything unmatched that's known is illegal",
          "include": "#illegal"
        }
      ]
    },
    "scopes.method.nested": {
      "patterns": [
        {
          "comment": "nested functions or methods or class constructs are illegal",
          "match": "\\bfunction|class|private|public|constructor|property|method\\b",
          "name": "invalid.illegal.jikiscript"
        },

        { "include": "#statements.variable.reassignment.instance" },
        { "include": "#statements.instance.method-call" },
        { "include": "#property-access" },
        { "include": "#control.functions" },

        { "include": "#literals" },
        { "include": "#comments" },
        { "include": "#statements.variable.assignment.local" },
        { "include": "#statements.method.for-each" },
        { "include": "#statements.method.loop.conditional" },
        { "include": "#statements.method.loop" },
        { "include": "#statements.instance-creation.instance" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions.instance" },
        { "include": "#support.functions.drawing.instance" },
        { "include": "#statements.function-call.instance" },
        { "include": "#punctuation" },
        {
          "comment": "everything unmatched that's known is illegal",
          "include": "#illegal"
        }
      ]
    },
    "scopes.function.loop": {
      "patterns": [
        {
          "comment": "nested functions or methods or class constructs are illegal",
          "match": "\\bfunction|class|private|public|constructor|property|method\\b",
          "name": "invalid.illegal.jikiscript"
        },

        { "include": "#control.enumeration" },
        { "include": "#control.functions" },

        { "include": "#literals" },
        { "include": "#comments" },
        { "include": "#statements.variable.assignment.local" },
        { "include": "#statements.for-each.function" },
        { "include": "#statements.conditional.function-loop" },
        { "include": "#statements.loop.function" },
        { "include": "#statements.instance-creation" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions" },
        { "include": "#support.functions.drawing" },
        { "include": "#statements.function-call" },
        { "include": "#punctuation" },
        {
          "comment": "everything unmatched that's known is illegal",
          "include": "#illegal"
        }
      ]
    },
    "scopes.function.nested": {
      "patterns": [
        {
          "comment": "nested functions or methods or class constructs are illegal",
          "match": "\\bfunction|class|private|public|constructor|property|method\\b",
          "name": "invalid.illegal.jikiscript"
        },

        { "include": "#control.functions" },

        { "include": "#literals" },
        { "include": "#comments" },
        { "include": "#statements.variable.assignment.local" },
        { "include": "#statements.for-each.function" },
        { "include": "#statements.conditional.function" },
        { "include": "#statements.loop.function" },
        { "include": "#statements.instance-creation" },
        { "include": "#statements.method-call" },
        { "include": "#support.functions" },
        { "include": "#support.functions.drawing" },
        { "include": "#statements.function-call" },
        { "include": "#punctuation" },
        {
          "comment": "everything unmatched that's known is illegal",
          "include": "#illegal"
        }
      ]
    }
  }
}
